generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model super_admin {
  super_admin_id Int       @id @default(autoincrement())
  role           String    @default("super_admin")
  admin_email    String    @unique @db.VarChar(50)
  admin_name     String    @db.VarChar(50)
  admin_pin      String    @unique 
  password       String    @unique 
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  deleted_at     DateTime?
  is_deleted     Boolean   @default(false)
}

model user {
  user_id      Int           @id @default(autoincrement())
  user_name    String        @unique  @db.VarChar(50)
  email        String        @unique  @db.VarChar(100)
  pin          String        @unique  
  password     String        
  role         has_role
  class        hierarchy
  created_at   DateTime      @default(now())
  updated_at   DateTime      @updatedAt
  deleted_at   DateTime?
  is_deleted   Boolean       @default(false)
  user_closing open_close[]  @relation("user_closed")
  user_opening open_close[]  @relation("user_open")
  company      company?       @relation(fields: [company_id], references: [company_id])
  company_id   Int?
  outlet       outlet?       @relation(fields: [outlet_id], references: [outlet_id])
  outlet_id    Int?
  branches     branch? @relation(fields: [branch_id], references: [branch_id])  
  branch_id    Int?
  store_staff  store_staff[]
  transaction  transaction[]
}

model company {
  company_id        Int       @id @default(autoincrement())
  company_name      String    @unique @db.VarChar(50)
  company_owner     String    @db.VarChar(30)
  company_address   String    @db.Text
  company_email     String    @db.VarChar(50)
  company_phone     String    @db.VarChar(30)
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
  deleted_at        DateTime?
  is_deleted        Boolean   @default(false)
  users             user[]
  branches          branch[]
  outlets           outlet[]
  open_close        open_close[]
}

model branch {
  branch_id       Int       @id @default(autoincrement())
  branch_name     String    @unique @db.VarChar(50)
  branch_address  String    @db.Text
  branch_email    String    @db.VarChar(50)
  branch_phone    String    @db.VarChar(30)
  branch_area     String    @db.Text
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?
  is_deleted      Boolean   @default(false)
  company         company   @relation(fields: [company_id], references: [company_id])
  company_id      Int
  outlets         outlet[]
  open_close      open_close[]
  users           user[]
}

model outlet {
  outlet_id       Int       @id @default(autoincrement())
  outlet_name     String    @unique @db.VarChar(50)
  outlet_address  String    @db.Text
  outlet_email    String    @db.VarChar(50)
  outlet_phone    String    @db.VarChar(30)
  outlet_area     String    @db.Text
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?
  is_deleted      Boolean   @default(false)
  company         company   @relation(fields: [company_id], references: [company_id])
  company_id      Int
  branch          branch    @relation(fields: [branch_id], references: [branch_id])
  branch_id       Int
  users           user[]
  open_close      open_close[]
  stores          store[]
}

model store {
  store_id           Int                 @id @default(autoincrement())
  outlet_id          Int
  store_name         String              @unique
  store_address      String              @unique
  created_at         DateTime            @default(now())
  updated_at         DateTime            @updatedAt
  deleted_at         DateTime?
  driver_partners    driver_partner[]
  driver_partner_store driver_partner_store[]
  inventories        inventory[]
  payments           payment[]
  products           product[]
  product_category   product_category[]
  outlet             outlet              @relation(fields: [outlet_id], references: [outlet_id])
  store_staff        store_staff[]
  store_supply       store_supplier[]
  transaction        transaction[]
}

model open_close {
  open_close_id   Int       @id @default(autoincrement())
  user_id         Int?
  company_id      Int?
  branch_id       Int?
  outlet_id       Int?
  is_cashier_open Boolean   @default(false)
  open_date       DateTime? @default(now())
  open_by         Int?
  close_date      DateTime? @default(now())
  close_by        Int?
  bill_quantity   Int
  created_at      DateTime  @default(now())
  updated_at      DateTime  @updatedAt
  deleted_at      DateTime?

  user_closed     user?     @relation("user_closed", fields: [close_by], references: [user_id])
  user_opened     user?     @relation("user_open", fields: [open_by], references: [user_id])
  company         company?  @relation(fields: [company_id], references: [company_id])
  branch          branch?   @relation(fields: [branch_id], references: [branch_id])
  outlet          outlet?   @relation(fields: [outlet_id], references: [outlet_id])

  @@unique([user_id, company_id, branch_id, outlet_id, open_date, close_date])
}

model tax {
  tax_id              Int           @id @default(autoincrement())
  tax_type            tax_type
  tax_name            String        @unique
  tax_value           Int?
  service_value       Int?           @default(0)
  tax_status          Boolean       @default(false)
  created_at          DateTime      @default(now())
  updated_at          DateTime      @updatedAt
  deleted_at          DateTime?
  supplier_supplier_id Int?
  product_tax         product_tax[]
  supplier_tax        supplier_tax[]
  supplier            supplier?     @relation(fields: [supplier_supplier_id], references: [supplier_id])
  transaction         transaction[]
}

model product_category {
  product_category_id Int       @id @default(autoincrement())
  store_id            Int
  category_name       String
  created_at          DateTime  @default(now())
  updated_at          DateTime  @updatedAt
  deleted_at          DateTime?
  store               store     @relation(fields: [store_id], references: [store_id])
  product             product[]
}

model inventory {
  inventory_id      Int                 @id @default(autoincrement())
  product_id        Int
  store_id          Int
  inventory_name    String
  in_storage_date   DateTime            @default(now())
  value_stored      Int
  value_out         Int
  out_storage_date  DateTime            @default(now())
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt
  deleted_at        DateTime?
  product           product             @relation(fields: [product_id], references: [product_id])
  store             store               @relation(fields: [store_id], references: [store_id])
  inventory_supply  inventory_supplier[]

  @@unique([product_id, store_id])
}

model supplier {
  supplier_id       Int                 @id @unique @default(autoincrement())
  supplier_name     String
  supplier_product  String
  phone_number      String
  email             String              @unique
  created_at        DateTime            @default(now())
  updated_at        DateTime            @updatedAt
  deleted_at        DateTime?
  inventory_supply inventory_supplier[]
  store_supply      store_supplier[]
  supplier_tax       supplier_tax[]
  taxes              tax[]
}

model driver_partner {
  driver_partner_id  Int                  @id @default(autoincrement())
  store_id           Int
  partner_name       String               @unique
  benefit            Float
  created_at         DateTime             @default(now())
  updated_at         DateTime             @updatedAt
  deleted_at         DateTime?
  stores             store                @relation(fields: [store_id], references: [store_id])
  driver_partner_store driver_partner_store[]
  transaction        transaction[]

  @@unique([store_id, partner_name])
}

model payment {
  payment_id   Int          @id @default(autoincrement())
  store_id     Int?
  payment_name String
  payment_type payment_type
  created_at   DateTime     @default(now())
  updated_at   DateTime     @updatedAt
  deleted_at   DateTime?
  store        store?       @relation(fields: [store_id], references: [store_id])
}

model product {
  product_id          Int            @id @default(autoincrement())
  store_id            Int
  product_category_id Int
  product_name        String         @unique
  product_price       Int
  cost_of_good_sold   Int
  product_code        Int
  product_image       String?
  created_at          DateTime       @default(now())
  updated_at          DateTime       @updatedAt
  deleted_at          DateTime?

  inventories         inventory[]
  product_category    product_category @relation(fields: [product_category_id], references: [product_category_id])
  store               store           @relation(fields: [store_id], references: [store_id])
  product_promos      product_promo[]
  product_taxes       product_tax[]
  transactions        transaction_product[]
}

model transaction_product {
  id             Int       @id @default(autoincrement())
  transaction_id Int
  product_id     Int
  quantity       Int
  saved_order_id Int?
  
  transaction    transaction @relation(fields: [transaction_id], references: [transaction_id])
  product        product     @relation(fields: [product_id], references: [product_id])
  saved_order    saved_order? @relation(fields: [saved_order_id], references: [saved_order_id])
  
  @@unique([transaction_id, product_id])
}

model transaction {
  transaction_id   Int                @id @default(autoincrement())
  store_id         Int
  user_id          Int
  tax_id           Int
  driver_partner   String?
  order_type       order_type
  receipt_number   String             @unique
  quantity         Int
  change           Int?
  sub_total        Float
  grand_total      Float
  payment_type     order_payment_type
  customer_name    String
  whatsapp_number  String

  created_at       DateTime           @default(now())
  updated_at       DateTime           @updatedAt
  deleted_at       DateTime?

  store            store              @relation(fields: [store_id], references: [store_id])
  user             user               @relation(fields: [user_id], references: [user_id])
  taxes            tax                @relation(fields: [tax_id], references: [tax_id])
  partner          driver_partner?    @relation(fields: [driver_partner], references: [partner_name])
  products         transaction_product[]
  saved_orders     saved_order[]
}

model promo {
  promo_id     Int            @id @default(autoincrement())
  product_id   Int?
  promo_type   promo_type
  promo_value  Int
  start_date   DateTime       @default(now())
  end_date     DateTime       @default(now())
  created_at   DateTime       @default(now())
  updated_at   DateTime       @updatedAt
  deleted_at   DateTime?
  promo_name   String
  product_promo product_promo[]
}

model product_promo {
  product_id Int
  promo_id   Int
  id         Int     @id @default(autoincrement())
  product    product @relation(fields: [product_id], references: [product_id])
  promo      promo   @relation(fields: [promo_id], references: [promo_id])

  @@unique([product_id, promo_id])
}

model product_tax {
  product_id     Int
  tax_id         Int
  product_tax_id Int     @id @default(autoincrement())
  product        product @relation(fields: [product_id], references: [product_id])
  tax            tax     @relation(fields: [tax_id], references: [tax_id])

  @@unique([product_id, tax_id])
}


model driver_partner_store {
  driver_partner_id Int
  store_id          Int
  driver_partners   driver_partner @relation(fields: [driver_partner_id], references: [driver_partner_id])
  store             store         @relation(fields: [store_id], references: [store_id])

  @@id([driver_partner_id, store_id])
}

model store_supplier {
  store_id    Int
  supplier_id Int
  store       store    @relation(fields: [store_id], references: [store_id])
  supplier    supplier @relation(fields: [supplier_id], references: [supplier_id])

  @@id([store_id, supplier_id])
}

model inventory_supplier {
  inventory_id Int
  supplier_id  Int
  inventory    inventory @relation(fields: [inventory_id], references: [inventory_id])
  supplier     supplier  @relation(fields: [supplier_id], references: [supplier_id])

  @@id([inventory_id, supplier_id])
}

model supplier_tax {
  supplier_id Int
  tax_id      Int
  supplier    supplier @relation(fields: [supplier_id], references: [supplier_id])
  tax         tax      @relation(fields: [tax_id], references: [tax_id])

  @@id([supplier_id, tax_id])
}

model store_staff {
  store_staff_id Int       @id @default(autoincrement())
  store_id       Int
  user_id        Int
  role           String
  created_at     DateTime  @default(now())
  updated_at     DateTime  @updatedAt
  deleted_at     DateTime?
  store          store     @relation(fields: [store_id], references: [store_id])
  user           user      @relation(fields: [user_id], references: [user_id])
}

model saved_order {
  saved_order_id    Int          @id @default(autoincrement())
  transaction_id    Int?
  is_done           Boolean?      @default(false)
  status            String        

  created_at        DateTime     @default(now())
  updated_at        DateTime     @updatedAt
  deleted_at        DateTime?

  transaction           transaction? @relation(fields: [transaction_id], references: [transaction_id])
  transaction_products  transaction_product[]  
}


enum has_role {
  owner
  hr
  head
  manager
  spv
  staff
  cashier
  waiter
}

enum hierarchy {
  company
  branch
  outlet
}

enum tax_type {
  service
  vat
}

enum payment_type {
  bank_transfer
  e_payment
  cash
}

enum order_type {
  order
  take_away
}

enum order_payment_type {
  cash
  bank_transfer
  e_payment 
}

enum promo_type {
  discount
  sales
}
